---
import BaseLayout from '../layouts/BaseLayout.astro';
import Layout from '../components/Layout.tsx';
import CatalogHeader from '../components/catalog/CatalogHeader.tsx';
import CatalogPage from '../components/catalog/CatalogPage.tsx';
import { getVisibleProducts } from '../utils/contentCollections';

const visibleTrucks = await getVisibleProducts();

// Get search query from URL
const url = Astro.url;
const searchQuery = url.searchParams.get('q') || '';
---

<BaseLayout
  title={searchQuery ? `Tìm kiếm: ${searchQuery} | soosanmotor.com` : "Tìm kiếm xe | soosanmotor.com"}
  description={`Kết quả tìm kiếm cho "${searchQuery}". Tìm xe tải, xe cẩu, sơ mi rơ mooc, xe đầu kéo phù hợp với nhu cầu của bạn.`}
>
  <Layout client:load>
    <div class="container mx-auto px-4 py-8">
      {searchQuery && (
        <div class="mb-6">
          <h1 class="text-3xl font-bold text-gray-800">
            Kết quả tìm kiếm cho: <span class="text-primary">"{searchQuery}"</span>
          </h1>
        </div>
      )}

      <CatalogHeader client:load initialVehicleCount={visibleTrucks.length} />

      <CatalogPage client:load initialVehicles={visibleTrucks} initialSearchQuery={searchQuery} />
    </div>
  </Layout>
</BaseLayout>
